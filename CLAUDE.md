# CLAUDE.md

This file provides guidance to Claude Code (claude.ai/code) when working with code in this repository.

## Project Overview
OSS implementation of Apple's Foundation Models framework (WWDC 2025), providing on-device LLM capabilities with structured generation, tool calling, and streaming support.

## Build Commands
- Build: `swift build`
- Test: `swift test`
- Test specific: `swift test --filter TestName`
- Release build: `swift build -c release`
- Lint/Format: `swift-format --in-place --recursive Sources/ Tests/`

## Architecture

### Core Components
1. **SystemLanguageModel**
   - Static `default` property
   - `availability: AvailabilityStatus` property
   - `isAvailable: Bool` convenience property

2. **LanguageModelSession**
   - Init with optional `Instructions` and `[Tool]`
   - `respond(to: Prompt) async throws -> Response`
   - `streamResponse(to: Prompt) -> AsyncThrowingStream<PartialResponse, Error>`
   - Generic streaming: `streamResponse<T: Generable>(to: Prompt, generating: T.Type)`

3. **Protocols**
   - `Generable`: Types that can be generated by the model
   - `Tool`: Function-calling protocol with associated Arguments type

4. **Macros**
   - `@Generable`: Generates schema conformance
   - `@Guide`: Property-level generation hints

### Implementation Guidelines
- Use Swift 6.1+ features (actors, async/await, macros)
- All model interactions are async
- Stream responses use AsyncThrowingStream
- Tool arguments must be Generable
- 4096 token limit for input/output
- Error handling with typed AvailabilityStatus

### Testing Strategy
- Mock providers for unit tests
- Test streaming with AsyncSequence
- Verify Generable schema generation
- Tool execution mocking

## Key APIs to Implement

1. **AvailabilityStatus**
```swift
enum AvailabilityStatus {
    case available
    case unavailable(reason: UnavailabilityReason)
}
```

2. **Tool Protocol**
```swift
protocol Tool {
    associatedtype Arguments: Generable
    var name: String { get }
    var description: String { get }
    func call(arguments: Arguments) async throws -> ToolOutput
}
```

3. **Generable Macro Usage**
```swift
@Generable
struct MyType {
    @Guide(description: "Field description", .range(0...100))
    let field: Int
}
```

## Dependencies
- swift-syntax (for macro implementation)
- swift-async-algorithms (for streaming)
- Local/remote LLM providers (OpenAI, Anthropic, etc.)